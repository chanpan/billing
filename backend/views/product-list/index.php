<?php    //\appxq\sdii\utils\VarDumper::dump($output);use appxq\sdii\widgets\ModalForm; ?><div class="row">    <div class="col-md-12">        <br/>        <?= \backend\classes\BillManager::renderBillDetail()?>        <?=        ModalForm::widget([            'id' => 'modal-user-shipping',            'options' => ['tabindex' => false],        ]);        ?>        <div class="row">            <div class="col-md-12">                <h4 class="kt-portlet__head-title">                    <i class="fa fa-truck"></i> จัดการรถ                    <?php if (Yii::$app->user->can('manage_user_percent')): ?>                        <button class="btn btn-sm btn-outline-success btn-add-user-shipping">                            <i class="fa fa-plus"></i> เพิ่มคนขับ                        </button>                    <?php endif; ?>                </h4>                 <div id="preview-user-shipping"></div>                 <?php \richardfan\widget\JSRegister::begin(); ?>                 <script>                     $(".btn-add-user-shipping").on('click',function () {                         let url = '<?= \yii\helpers\Url::to(['/product-list/add-driver?type=1']); ?>';                         modalUserShipping(url);                         return false;                     });                     function modalUserShipping(url) {                         $('.modal').css('overflow', 'scroll');                         $('#modal-user-shipping .modal-content').html('<div class=\"sdloader \"><i class=\"sdloader-icon\"></i></div>');                         $('#modal-user-shipping').modal('show')                                 .find('.modal-content')                                 .load(url);                     }                     function initPreviewUserShipping() {                         let url = '<?= \yii\helpers\Url::to(['/product-list/init-preview-user-shipping']) ?>';                         $.get(url, function (result) {                             $("#preview-user-shipping").html(result);                         });                     }                     initPreviewUserShipping();                 </script>                 <?php \richardfan\widget\JSRegister::end(); ?>                </div>                         <div class="col-md-12">                <h4 class="kt-portlet__head-title"><i class="fa fa-money"></i> อัตราค่าตอบแทนของคนขับรถและลูกน้อง                    <?php if(Yii::$app->user->can('manage_user_percent')):?>                    <?= \yii\helpers\Html::button(\appxq\sdii\helpers\SDHtml::getBtnAdd(), ['data-url'=> \yii\helpers\Url::to(['user-percent/create']), 'class' => 'btn btn-sm btn-outline-success', 'id'=>'modal-addbtn-user-percent']). ' ';                    ?>                    <?php endif; ?>                </h4>                <div id="preview-user-percent"></div>                <?php \richardfan\widget\JSRegister::begin(); ?>                <script>                    function initUserPercent(){                        let url = '<?= \yii\helpers\Url::to(['/user-percent']) ?>';                        $.get(url, function (result) {                            $("#preview-user-percent").html(result);                        });                    }                    initUserPercent();                </script>                <?php \richardfan\widget\JSRegister::end(); ?>            </div>        </div>                <div class="row">            <div class="col-md-6 col-xs-6">                <div class="kt-section" >                    <div class="kt-section__primary"><label>ค่า Commission ที่จะได้รับ:</label></div>                    <div class="kt-section__content kt-section__content--solid kt-border-warning" style="background-color: #5cb85c;color:#fff;">                        <div id="preview-user-cal"></div>                        <?php \richardfan\widget\JSRegister::begin(); ?>                        <script>                            function initUserCal(){                                let url = '<?= \yii\helpers\Url::to(['/product-list/cal-percent']) ?>';                                $.get(url,function (result) {                                    $("#preview-user-cal").html(result);                                });                                return false;                            }                            initUserCal();                        </script>                        <?php \richardfan\widget\JSRegister::end(); ?>                    </div>                 </div>            </div>            <div class="col-md-6 col-xs-6">                <div class="kt-section">                    <div class="kt-section__info"><label>อัปโหลดรายการสินค้า:</label></div>                    <div class="kt-section__content kt-section__content--solid kt-border-success kt-bg-light">                        <form id="fupForm" enctype="multipart/form-data">                            <div class="statusMsg"></div>                            <div class="row">                                <div class="col-md-6 text-right">                                    <input id="exfile" name="exfile" type="file" accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel">                                 </div>                                <div class="col-md-6">                                    <button class="btn btn-success" id="btnUploadFile"><i class="fa fa-upload"></i> อัปโหลดรายการสินค้า</button>                                </div>                            </div>                        </form>                    </div>                    <?php \richardfan\widget\JSRegister::begin(); ?>                    <script>                        $("#exfile").change(function() {                            var file = this.files[0];                            var fileType = file.type;                            var match = ['.csv', 'application/msword', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'application/vnd.ms-excel'];                            if(!((fileType == match[0]) || (fileType == match[1]) || (fileType == match[2]) || (fileType == match[3]) || (fileType == match[4]) || (fileType == match[5]))){                                alert('Sorry, only xlsx files are allowed to upload.');                                $("#file").val('');                                return false;                            }                        });                        $('#fupForm').on('submit', function(e){                           let url = '<?= \yii\helpers\Url::to(['/product-list/upload']) ?>';                         e.preventDefault();                          $.ajax({                            type: 'POST',                            url: url,                            data: new FormData(this),                            dataType: 'json',                            contentType: false,                            cache: false,                            processData:false,                            beforeSend: function(){                                $('#btnUploadFile').attr("disabled","disabled");                                $('#fupForm').css("opacity",".5");                            },                            success: function(response){                                 console.log(response);                                $('.statusMsg').html('');                                if(response.status == 'success'){                                    $('#fupForm')[0].reset();                                    $('.statusMsg').html('<p class="alert alert-success">'+response.message+'</p>');                                }else{                                    $('.statusMsg').html('<p class="alert alert-danger">'+response.message+'</p>');                                }                                $('#fupForm').css("opacity","");                                $("#btnUploadFile").removeAttr("disabled");                            }                        });                                                                          });                    </script>                    <?php \richardfan\widget\JSRegister::end(); ?>                </div>               </div>        </div>                      <div class="sdbox-col">            <div class="kt-portlet">                <div class="kt-portlet__head kt-portlet__head--noborder  kt-ribbon kt-ribbon--danger kt-ribbon--shadow kt-ribbon--left kt-ribbon--round">                    <div class="kt-ribbon__target" style="top: 12px; right: -2px;">Commission</div>                    <div class="kt-portlet__head-label">                        <!--<h3 class="kt-portlet__head-title">Rounded Style</h3>-->                    </div>                </div>                <div class="kt-portlet__body kt-portlet__body--fit-top">                    <table class="table table-responsive table-bordered tableProduct">                    <thead>                        <tr>                            <th width="150">Item Code</th>                            <th>Item Name</th>                            <th>Unit</th>                            <th>Amount</th>                            <th>Unit Price</th>                            <th>Unit Discount</th>                            <th>Total Discount</th>                            <th>Net Price</th>                            <th>Group Name</th>                            <th>Percent</th>                            <th>Commission</th>                        </tr>                    </thead>                    <tbody>                        <?php if(isset($output['billDetail'])):?>                            <?php //\appxq\sdii\utils\VarDumper::dump($output['billDetail']); ?>                            <?php foreach($output['billDetail'] as $k=>$v):?>                                <tr>                                    <td><?= isset($v['itemcode'])?$v['itemcode']:'ไม่พบ ItemCode'; ?></td>                                    <td><?= isset($v['itemname'])?$v['itemname']:'ไม่พบ ItemName'; ?></td>                                    <td><?= isset($v['unit'])?$v['unit']:'ไม่พบ Unit'; ?></td>                                    <td><?= isset($v['amount'])?$v['amount']:'ไม่พบ Amount'; ?></td>                                    <td><?= isset($v['unitprice'])?$v['unitprice']:'ไม่พบ UnitPrice'; ?></td>                                    <td><?= isset($v['unitdiscount'])?$v['unitdiscount']:'ไม่พบ UnitDiscount'; ?></td>                                    <td><?= isset($v['totaldiscount'])?$v['totaldiscount']:'ไม่พบ TotalDiscount'; ?></td>                                    <td><?= isset($v['netprice'])?$v['netprice']:'ไม่พบ NetPrice'; ?></td>                                    <td><?= isset($v['groupname'])?$v['groupname']:'ไม่พบกลุ่ม'; ?></td>                                    <td>                                        <?php                                            $percent = isset($v['percent'])?$v['percent']:'';                                            if($percent == ''){                                                $percent = 'ไม่พบ Percen';                                            }else{                                                $percent = number_format($percent, 2);                                            }                                            echo $percent;                                        ?>                                    </td>                                    <td>                                        <?php                                        $commission = isset($v['commission'])?$v['commission']:'';                                        if($commission == ''){                                            $commission = 'ไม่พบ Commission';                                        }else{                                            $commission = number_format($commission, 2);                                        }                                        echo $commission;                                        ?>                                    </td>                                </tr>                            <?php endforeach;?>                        <?php endif;?>                    </tbody>                    <tfoot>                        <tr>                            <td colspan="9" class="text-right"><b>Total Commission</b></td>                            <td colspan="2" class="text-right">                                <b>                                <?php                                    $total = isset($output['totalCommission'])?$output['totalCommission']:0;                                    echo number_format($total, 2)                                ?>                                </b>                            </td>                        </tr>                    </tfoot>                </table>                </div>            </div>        </div>                             </div></div><?php \appxq\sdii\widgets\CSSRegister::begin()?><style>    table{        border-collapse: collapse;    }    table, th, td {        border: 1px solid black;    }</style><?php \appxq\sdii\widgets\CSSRegister::end()?>