<?php    use appxq\sdii\widgets\ModalForm;    $this->title = "รายงาน Bill ที่อัปโหลดจากไฟล์ Excel";?><div style="background: #fff;padding: 10px;">    <h3 class="text-center"><?= $this->title; ?></h3>    <?php        echo \kartik\grid\GridView::widget([            'dataProvider' => $dataProvider,            'columns' => [                [                    'format' => 'raw',                    'attribute' => 'docno',                    'value' => function ($model) {                        try {                            $sql = "                                    select concat(bt.name,'',billref) as docno, amount  from bill_items as bi                                     inner join bill_type as bt on bt.id = bi.bill_type                                     where concat(bt.name,'',billref) = :docno AND bi.rstat not in(0,3);                                ";                            $data = Yii::$app->db->createCommand($sql, [':docno' => $model->docno])->queryOne();                            if ($data) {                                return $model->docno;                            } else {                                return "                                        <div style='padding:5px;' class='kt-border-warning kt-section section-sm kt-portlet__body body-xs kt-font-warning content-border'>                                            <div class='row'>                                                <div class='col-md-8 col-xs-8 col-sm-8'>{$model->docno}</div>                                                <div class='col-md-4 col-xs-4 col-sm-4 text-right'><button class='btn btn-success btnAdd'><i class='fa fa-plus'></i></button></div>                                            </div>                                        </div>                                    ";                            }                        } catch (\yii\db\Exception $ex) {                        }                    }                ],                [                    'attribute' => 'docdate',                    'contentOptions' => ['style' => 'width:100px'],                    'value' => function ($model) {                        if ($model->docdate) {                            return \appxq\sdii\utils\SDdate::mysql2phpDate($model->docdate);                        }                    }                ],[                    'format' => 'raw',                    'contentOptions' => ['style' => 'width:100px'],                        'label'=>'รายการสินค้า',                        'value'=>function($model){                            return "<button data-docno='{$model->docno}' class='btn btn-default btnViewProduct'>ดูรายการสินค้า</button>";                        }                ]            ]        ]);         ?></div><?=ModalForm::widget([    'id' => 'modal-bill-items',    'options' => ['tabindex' => false],    'size' => 'modal-lg',    //         'clientOptions' => ['backdrop' => 'static', 'keyboard' => false]]);?><?php \richardfan\widget\JSRegister::begin(); ?><script>    $(".btnAdd").on('click', function(){        let url = '<?= \yii\helpers\Url::to(['/bill-items/create'])?>';        modalBillItem(url);        return false;    });    $(".btnViewProduct").on('click', function(){        let id = $(this).attr('data-docno');        let url = '<?= \yii\helpers\Url::to(['/report/sell-product-by-docno?docno='])?>'+id;        modalBillItem(url);        return false;    });    function modalBillItem(url) {        $('.modal').css('overflow', 'scroll');        $('#modal-bill-items .modal-content').html('<div class=\"sdloader \"><i class=\"sdloader-icon\"></i></div>');        $('#modal-bill-items').modal('show')            .find('.modal-content')            .load(url);    }</script><?php \richardfan\widget\JSRegister::end(); ?>